<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ClaimPX Telegram Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <h2>Login with Telegram</h2>

  <!-- Telegram Login Widget -->
  <script async src="https://telegram.org/js/telegram-widget.js?7"
          data-telegram-login="uxxucc_bot"
          data-size="large"
          data-userpic="true"
          data-request-access="write"
          data-on-auth="onTelegramAuth">
  </script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDD0mTSuECptBeNzKpiaCDbbCJIoW9SiTg",
      authDomain: "claimpx.firebaseapp.com",
      projectId: "claimpx",
      storageBucket: "claimpx.firebasestorage.app",
      messagingSenderId: "1012471480360",
      appId: "1:1012471480360:web:3b16bc6acc6adcf371b51d",
      measurementId: "G-NYK5SSMCF3"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const analytics = getAnalytics(app);

    // Telegram login callback (must be global!)
    window.onTelegramAuth = async function(user) {
      const userRef = doc(db, "telegram_users", String(user.id));
      await setDoc(userRef, {
        id: user.id,
        first_name: user.first_name,
        username: user.username || null,
        photo_url: user.photo_url || null,
        timestamp: serverTimestamp()
      });

      alert(`Welcome, ${user.first_name}! Your login was saved.`);
    };
  </script>
</body>
</html>
